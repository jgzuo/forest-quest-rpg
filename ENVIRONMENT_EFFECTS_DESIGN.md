# 🌤️ 环境特效系统设计方案

## 🎯 系统概述

为 Forest Quest RPG 添加动态环境特效，包括：
- 🌧️ **天气系统** - 雨、雪、雾、晴
- 🌅 **昼夜循环** - 早晨、中午、黄昏、夜晚
- 💡 **动态光照** - 随时间变化的光照和阴影
- ✨ **环境粒子** - 落叶、萤火虫、雪花

---

## 📊 功能列表

### 1. 天气系统

| 天气类型 | 视觉效果 | 影响因素 |
|---------|---------|---------|
| ☀️ 晴天 | 明亮，无特效 | 标准 |
| 🌧️ 小雨 | 雨滴粒子，轻微变暗 | 能见度略降 |
| ⛈️ 大雨 | 密集雨滴，明显变暗 | 能见度降低 |
| ❄️ 小雪 | 雪花飘落 | 地面积雪 |
| 🌨️ 暴雪 | 大量雪花，强风 | 能见度极低 |
| 🌫️ 雾天 | 白色雾气覆盖 | 能见度大幅降低 |
| ☁️ 阴天 | 灰暗光线 | 整体变暗 |

### 2. 昼夜循环

| 时间段 | 时长 | 光照颜色 | 视觉效果 |
|--------|------|---------|---------|
| 🌅 早晨 | 3分钟 | 橙红色渐变 | 日出效果 |
| ☀️ 中午 | 4分钟 | 白色明亮 | 最亮 |
| 🌆 黄昏 | 3分钟 | 橙黄色渐变 | 日落效果 |
| 🌙 深夜 | 4分钟 | 蓝色昏暗 | 黑暗，增加难度 |

**周期**: 14分钟完整循环

### 3. 动态光照

- **光源跟随** - 光照随太阳/月亮位置变化
- **阴影系统** - 物体投射动态阴影
- **环境光** - 整体色调随时间变化
- **粒子发光** - 萤火虫、魔法光辉

---

## 🛠️ 技术实现

### 文件结构

```
src/
├── systems/
│   └── WeatherSystem.js      # 天气系统
├── managers/
│   └── DayNightManager.js     # 昼夜循环管理器
└── particles/
    └── WeatherParticles.js    # 天气粒子效果
```

### 关键类

#### WeatherSystem.js
- 管理当前天气状态
- 切换天气效果
- 更新天气粒子

#### DayNightManager.js
- 管理昼夜循环
- 计算光照颜色
- 更新环境光

#### WeatherParticles.js
- 雨滴粒子系统
- 雪花粒子系统
- 雾气效果

---

## 🎨 视觉设计

### 天气粒子

**雨滴**:
- 纹理：细长线段，蓝色渐变
- 速度：快速下落
- 数量：小雨100，大雨500

**雪花**:
- 纹理：白色圆形/六边形
- 速度：缓慢飘落，带旋转
- 数量：小雪50，暴雪300

**雾气**:
- 纹理：半透明白色渐变
- 位置：屏幕覆盖
- 透明度：根据浓度变化

### 昼夜光照

**早晨** (6:00-9:00):
```
R: 255 → 255
G: 200 → 255
B: 150 → 255
```

**中午** (9:00-15:00):
```
R: 255
G: 255
B: 255
```

**黄昏** (15:00-18:00):
```
R: 255 → 200
G: 255 → 150
B: 255 → 100
```

**夜晚** (18:00-6:00):
```
R: 100 → 50
G: 100 → 50
B: 150 → 100
```

---

## 🎮 游戏影响

### 战斗影响

| 天气/时间 | 玩家效果 | 敌人效果 |
|----------|---------|---------|
| 🌙 深夜 | 视野降低 | 敌人攻击+10% |
| 🌧️ 小雨 | 无影响 | 敌人速度-10% |
| ⛈️ 大雨 | 移动速度-20% | 敌人速度-20% |
| ❄️ 小雪 | 无影响 | 敌人速度-15% |
| 🌫️ 雾天 | 能见度-50% | 敌人感知+20% |

### 探索影响

- **夜晚**: 更难发现敌人，但掉落增加
- **雨天**: 滑动风险，移动减速
- **雪天**: 地面变滑，可以滑行
- **雾天**: 隐藏宝箱更容易被发现

---

## 📈 实现优先级

### Phase 1: 基础天气（推荐先做）
- ✅ 晴天/雨天切换
- ✅ 雨滴粒子效果
- ✅ 基础视觉变化

### Phase 2: 昼夜循环
- ✅ 时间系统
- ✅ 光照变化
- ✅ 昼夜切换

### Phase 3: 高级天气
- ✅ 雪天系统
- ✅ 雾天系统
- ✅ 天气渐变过渡

### Phase 4: 高级特效
- ✅ 环境粒子（萤火虫、落叶）
- ✅ 动态阴影
- ✅ 光源系统

---

## 🚀 快速开始

### 最小实现（30分钟）

1. **创建天气粒子系统**
2. **实现晴天/雨天切换**
3. **添加基础光照变化**

### 完整实现（2-3小时）

1. **完整的天气系统**
2. **昼夜循环**
3. **游戏影响机制**
4. **UI显示**

---

**准备好开始了吗？** 我可以从最简单的天气系统开始实现！🌧️✨
